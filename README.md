# TimeFlow Bot — обновление ролей (от 2025-08-20)

Телеграм-бот для тайм-менеджмента с Pomodoro, привычками, чек-листом и ИИ‑ассистентом.
Это обновление фиксирует **новое распределение ролей** между ИИ‑инструментами и уточняет рабочий процесс.
Кодовая база и API остаются без изменений.

## Роли и ответственность (обновлено)
- **Claude 4.1 Opus — Архитектор/Исполнитель**
  - Проектирует решения, пишет код/патчи, проводит миграции БД/индексов Firestore.
  - Поддерживает асинхронность (aiogram 3.4.x, Python 3.12), транзакции Firestore, атомарные инкременты.
  - Отдаёт `git diff`‑патчи, минимальные и проверяемые.

- **GPT‑5 — Планирование и операционный контроль**
  - Ведёт roadmap, пайплайны, планирование спринтов.
  - Формирует ТЗ, снапшоты состояния проекта, инструкции и пошаговые гайды для владельца.
  - Пишет промты для Claude/Codex, генерирует идеи по улучшениям.

- **Codex — Ревьюер/Тестировщик**
  - Проводит код‑ревью, пишет/генерирует тесты (pytest), моделирует риски и регрессии.
  - Проверяет соответствие чек‑листам проекта и CI.

## Инварианты проекта
- Python 3.12, aiogram 3.4.x, Firestore; только async/await, никаких блокирующих вызовов.
- Pomodoro: устойчивость, recovery после рестартов; `pomodoro_sessions.ends_at`.
- Firestore: транзакции, индексы, атомарные инкременты; избегать «горячих» документов.
- Анти‑абьюз: идемпотентность действий, rate‑limits, дедупликация.
- CI/CD: PR → ruff, black --check, pytest; main → деплой через SSH + systemd; post‑deploy smoke `/health`.
- Логи: JSON без PII, уровни INFO/ERROR; метрики ошибок/латентности/уведомлений.

Подробности — в `docs/ROLES_AND_FLOW.md` и `docs/WORKFLOW.md`.
